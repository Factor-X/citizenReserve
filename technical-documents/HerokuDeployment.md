# Heroku deployment

## Login

Go to http://www.heroku.com > Log in

The login credentials are:

fournisseurs@factorx.eu / factorx07

## Download / restore a backup database

In the production environment (similarly in the dev environment).

- Select the application of interest (citizenreserve for example).
- Select the Heroku Postgres add-on of interest (Heroku Postgres :: Green, for example).
- Select 'PG Backups' on the menu at the top of the page.
- A table is displayed with all the available backups and a 'Download' button.

Note that the name of the downloaded file will be some kind of UUID. You will need to add a '.backup' extension.
Otherwise, PGAdmin will refuse to restore it.

Start PGAdmin. If not already done:

- Add a new login role: Login Roles > New Login Role ... for role name 'play' with password 'play'.
- Create the database: New Database ... with name 'citizens-reserve' and owner 'play'.
- Restore the backup: Restore ... with the downloaded and renamed '.backup' file as the filename.

You should get a database with 11 tables: accounts ... surveys.

## Procfile

There is a Procfile file in the root of the project (this is the mandatory place). A Procfile declares what commands are
run by the deployed application on the Heroku platform.

The Procfile of Citizens Reserve contains the following:

web: target/universal/stage/bin/citizens "-Dhttp.port=${PORT} -DapplyEvolutions.default=true -DapplyDownEvolutions.default=false -Ddb.default.driver=org.postgresql.Driver -Ddb.default.url=${DATABASE_URL}"

The 'web' process type starts the application server.

The target/universal/stage/bin/{your project name} file is automatically generated by Heroku. Heroku detects a Play
application by looking for the conf/application.conf file. Note that this is for Play 2.2+. Other versions lead to
other web process parameters.

## Application access and administration

The production application can be accessed at the following URL:

http://citizenreserve.herokuapp.com/#/fr/welcome

The administration interface to track the statistics of the tool at:

https://citizenreserve.herokuapp.com/#/fr/admin/

The login credentials for this admin access are:

factorx@factorx.eu / GU57IYjGjg

The password can be modified (directly in encrpyted version) via the file: citizens-reserve/conf/evolutions/default/6.sql

## Full deployment procedure (based on AWAC)

The deployment procedure is identical to the one for AWAC except that the application is this time compiled remotely on
Heroku.

Cf. https://github.com/Factor-X/awac/tree/master/operational-procedures/Heroku%20deployment

